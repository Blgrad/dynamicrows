!function(e){e.fn.dynamicrows=function(t){function a(t){var a=e(t).closest(d.row);if(e.fn.autocompleteInput&&f.find("input[data-autocomplete-input]").autocompleteInput("destroy"),d.beforeAdd){var n=d.beforeAdd(a);if(n===!1)return!1}if(d.copyRow)var l=e(t).closest(d.rows).children(d.row+":nth-child("+d.copyRow+")").clone(!0);else var l=a.clone(!0);return l.length?(i(l,!0),d.copyValues&&r(a,l),e.fn.datepick&&l.find("input.datepicker").datepick("destroy"),"fade"==d.animation?(l.hide().insertAfter(a),l.fadeIn(d.animation_speed)):l.insertAfter(a),d.prevent_renaming||o(),e.fn.datepick&&l.find("input.datepicker").datepick(),e.fn.autocompleteInput&&f.find("input[data-autocomplete-input]").autocompleteInput(),d.afterAdd&&d.afterAdd(l),void(d.afterAll&&d.afterAll(l))):!1}function n(t){var a=e(t).closest(d.row);if(d.beforeRemove){var n=d.beforeRemove(a);if(n===!1)return!1}var r=f.children(d.row).length;r>d.minrows?("fade"==d.animation?a.fadeOut(d.animation_speed,function(){e(this).remove()}):a.remove(),d.prevent_renaming||o(),a=null):(i(a),e.fn.autocompleteInput&&a.find("input[data-autocomplete-input]").autocompleteInput("deselect")),d.afterRemove&&d.afterRemove(a),d.afterAll&&d.afterAll(a)}function o(){var t=/(.*?)(\[\d+?\])(?!\[\d+?\])(.*)/g,a=d.index_start-1;f.find(d.row).each(function(){var n=e(this);d.beforeFormUpdateNames&&d.beforeFormUpdateNames(n),a++,n.find(":input").each(function(){e(this).attr("name",function(e,n){return void 0===n?!0:n.replace(t,function(e,t,n,o){return t+"["+a+"]"+o})}).removeAttr("id")}),d.increment&&n.find(d.increment).html(a+1),d.afterFormUpdateNames&&d.afterFormUpdateNames(n)})}function r(t,a){t.find(":text, textarea, select:not(multiple)").each(function(){var t=e(this),n=t.attr("name");a.find('[name="'+n+'"]').val(t.val())}),t.find(":checkbox, :radio").each(function(){var t=e(this),n=t.attr("name");a.find('[name="'+n+'"]').prop("checked",t.prop("checked"))})}function i(t,a){e(".disabled",t).removeClass("disabled");var n=t.find(":input");n.length&&(n.filter('input[type="hidden"]').val(""),a&&d.copyValues!==!1||n.each(function(){var t=e(this),a=t.prop("type");switch(a){case"color":case"date":case"datetime-local":case"email":case"month":case"number":case"password":case"range":case"search":case"select-one":case"tel":case"text":case"time":case"url":case"week":t.val("");break;case"select-multiple":t.find("option").prop("selected",!1);break;case"checkbox":case"radio":t.prop("checked",!1)}}))}var l=e(this),d=e.extend({row:"tr",rows:"tbody",minrows:1,copyRow:null,copyValues:!1,increment:null,handle_add:"[data-add]:not(.disabled)",handle_remove:"[data-remove]:not(.disabled)",handle_move:"[data-move]:not(.disabled)",index_start:0,beforeAdd:null,beforeRemove:null,beforeMove:null,beforeFormUpdateNames:null,beforeAll:null,afterAdd:null,afterRemove:null,afterMove:null,afterFormUpdateNames:null,afterAll:null,animation:!1,animation_speed:300},t),c=l.data();"object"==typeof c&&e.each(c,function(e,t){"undefined"!=typeof d[e]&&("string"==typeof t&&0==t.length&&(t=!0),d[e]=t)});var f=d.rows?e(d.rows,this):l;if(d.handle_add&&l.on("click",d.handle_add,function(e){e.preventDefault(),a(this)}),d.handle_remove&&l.on("click",d.handle_remove,function(e){e.preventDefault(),n(this)}),d.handle_move&&f.find(d.handle_move).length>0)if("undefined"!=typeof Sortable){var s=f[0];f.find(d.handle_move).each(function(){var t=e(this).closest(d.row);t.addClass("dynamicrows-row"),t.find(d.handle_move).addClass("dynamicrows-move")});new Sortable(s,{handle:".dynamicrows-move",draggable:".dynamicrows-row",onStart:function(e){d.beforeMove&&d.beforeMove(e.item),d.beforeAll&&d.beforeAll(e.item)},onUpdate:function(e){o(),d.afterMove&&d.afterMove(e.item),d.afterAll&&d.afterAll(e.item)}})}else if(jQuery.fn.sortable){var u=[];f.find(d.handle_move).each(function(){u.push(e(this).closest(d.row))}),f.sortable({items:u,handle:d.handle_move,start:function(e,t){d.beforeMove&&d.beforeMove(t.item),d.beforeAll&&d.beforeAll(t.item)},update:function(e,t){d.prevent_renaming||o(),d.afterMove&&d.afterMove(t.item),d.afterAll&&d.afterAll(t.item)}})}else alert("No sortable-plugin found! Please load sortablejs or jquery-ui (with sortable widget).")}}(jQuery),window.Dynamicrows={init:function(e,t){if("string"==typeof e)var e=$(el);e.length&&(t||(t={}),e.each(function(){var e=$(this),a=e.data();a||(a={});var n=$.extend({},a,t);e.dynamicrows(n)}))}};