!function(e){e.fn.dynamicrows=function(t){function n(t){var n=e(t).closest(d.row);if(e.fn.autocompleteInput&&c.find("input[data-autocomplete-input]").autocompleteInput("destroy"),d.beforeAdd){var a=d.beforeAdd(n);if(a===!1)return!1}if(d.copyRow)var l=e(t).closest(d.rows).children(d.row+":nth-child("+d.copyRow+")").clone(!0);else var l=n.clone(!0);return l.length?(i(l,!0),d.copyValues&&r(n,l),e.fn.datepick&&l.find("input.datepicker").datepick("destroy"),"fade"==d.animation?(l.hide().insertAfter(n),l.fadeIn(d.animation_speed)):l.insertAfter(n),d.prevent_renaming||o(),e.fn.datepick&&l.find("input.datepicker").datepick(),e.fn.autocompleteInput&&c.find("input[data-autocomplete-input]").autocompleteInput(),d.afterAdd&&d.afterAdd(l),void(d.afterAll&&d.afterAll(l))):!1}function a(t){var n=e(t).closest(d.row);if(d.beforeRemove){var a=d.beforeRemove(n);if(a===!1)return!1}var r=c.children(d.row).length;r>d.minrows?("fade"==d.animation?n.fadeOut(d.animation_speed,function(){e(this).remove()}):n.remove(),d.prevent_renaming||o(),n=null):(i(n),e.fn.autocompleteInput&&n.find("input[data-autocomplete-input]").autocompleteInput("deselect")),d.afterRemove&&d.afterRemove(n),d.afterAll&&d.afterAll(n)}function o(){var t=/(.*?)(\[\d+?\])(?!\[\d+?\])(.*)/g,n=d.index_start-1;c.find(d.row).each(function(){var a=e(this);d.beforeFormUpdateNames&&d.beforeFormUpdateNames(a),n++,a.find(":input").each(function(){e(this).attr("name",function(e,a){return void 0===a?!0:a.replace(t,function(e,t,a,o){return t+"["+n+"]"+o})}).removeAttr("id")}),d.increment&&a.find(d.increment).html(n+1),d.afterFormUpdateNames&&d.afterFormUpdateNames(a)})}function r(t,n){t.find(":text, textarea, select:not(multiple)").each(function(){var t=e(this),a=t.attr("name");n.find('[name="'+a+'"]').val(t.val())}),t.find(":checkbox, :radio").each(function(){var t=e(this),a=t.attr("name");n.find('[name="'+a+'"]').prop("checked",t.prop("checked"))})}function i(t,n){e(".disabled",t).removeClass("disabled"),e('input[type="hidden"]',t).val(""),n&&d.copyValues!==!1||(e(":text, textarea",t).val(""),e(":checkbox, :radio",t).prop("checked",!1),e("select",t).children("option:selected").prop("selected",!1))}var l=e(this),d=e.extend({row:"tr",rows:"tbody",minrows:1,copyRow:null,copyValues:!1,increment:null,handle_add:"[data-add]:not(.disabled)",handle_remove:"[data-remove]:not(.disabled)",handle_move:"[data-move]:not(.disabled)",index_start:0,beforeAdd:null,beforeRemove:null,beforeMove:null,beforeFormUpdateNames:null,beforeAll:null,afterAdd:null,afterRemove:null,afterMove:null,afterFormUpdateNames:null,afterAll:null,animation:!1,animation_speed:300},t),f=l.data();"object"==typeof f&&e.each(f,function(e,t){"undefined"!=typeof d[e]&&("string"==typeof t&&0==t.length&&(t=!0),d[e]=t)});var c=d.rows?e(d.rows,this):l;if(d.handle_add&&l.on("click",d.handle_add,function(e){e.preventDefault(),n(this)}),d.handle_remove&&l.on("click",d.handle_remove,function(e){e.preventDefault(),a(this)}),d.handle_move&&c.find(d.handle_move).length>0)if("undefined"!=typeof Sortable){var u=c[0];c.find(d.handle_move).each(function(){var t=e(this).closest(d.row);t.addClass("dynamicrows-row"),t.find(d.handle_move).addClass("dynamicrows-move")});new Sortable(u,{handle:".dynamicrows-move",draggable:".dynamicrows-row",onStart:function(e){d.beforeMove&&d.beforeMove(e.item),d.beforeAll&&d.beforeAll(e.item)},onUpdate:function(e){o(),d.afterMove&&d.afterMove(e.item),d.afterAll&&d.afterAll(e.item)}})}else if(jQuery.fn.sortable){var m=[];c.find(d.handle_move).each(function(){m.push(e(this).closest(d.row))}),c.sortable({items:m,handle:d.handle_move,start:function(e,t){d.beforeMove&&d.beforeMove(t.item),d.beforeAll&&d.beforeAll(t.item)},update:function(e,t){d.prevent_renaming||o(),d.afterMove&&d.afterMove(t.item),d.afterAll&&d.afterAll(t.item)}})}else alert("No sortable-plugin found! Please load sortablejs or jquery-ui (with sortable widget).")}}(jQuery);